<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include href="../_incl/taglib.html"/>
<head>
  <title>recipe "${recipe.name}" | Brew Journal</title>
  <xi:include href="../_incl/head.html"/>
  <script type="application/javascript">
function set_delete_id_and_submit(form_name, item_id) {
  form_name = '#' + form_name;

  $(form_name)
  .find('[name=delete_id]')
  .val(item_id);

  $(form_name).get()[0].submit();
}

$(document).ready(function(){
  $('#first-focused').focus();
});
  </script>
</head>
<body>
<xi:include href="../_incl/body-top-bar.html"/>

<h1 py:if="recipe">recipe "${recipe.name}"</h1>

<div py:if="request.user.is_authenticated()">
    <a id="first-focused" href="/recipe/new/?clone_from_recipe_id=${recipe.id}">clone »</a>
    | <a href="/user/${request.user.username}/star/?recipe_id=${recipe.id}">star »</a>
    | <a href="/user/${request.user.username}/brew/new/?recipe_id=${recipe.id}">brew »</a>
</div>

<br /><br/>
<!-- h2>overview</h2 -->

<div id="overview">
  <div py:attrs="{'style': ['display:none', 'display:inherit'][not recipe_form.is_bound or recipe_form.is_valid()]}">
    <table width="60%">
      <tr><th width="15%">name</th><td>${recipe.name}</td></tr>
      <tr><th>style</th><td>${recipe.style.name} (${recipe.style.bjcp_code})</td></tr>
      <tr><th>batch_size</th><td>${recipe.batch_size} ${recipe.get_batch_size_units_display()}</td></tr>
      <tr><th>type</th><td>${recipe.get_type_display()}</td></tr>
    </table>
    <div py:if="std.auth_user_is_user(request, recipe.author)">
      <a href="#" id="edit" onClick="$('#overview').children().slideToggle(); $('#overview-form :input:first').focus(); return false;">edit &uarr;</a>
    </div>
  </div>
  <div py:if="std.auth_user_is_user(request, recipe.author)"
       py:attrs="{'style': ['display:none', 'display:inherit'][recipe_form.is_bound and not recipe_form.is_valid()]}">
    <form method="post" id="overview-form">
      <table width="60%" class="form" py:content="std.Markup(recipe_form.as_table())"/>
      <input type="submit" name="submit" value="update"/>
      <input type="reset" value="cancel" onClick="$('#overview').children().slideToggle(); $('#edit').focus(); return true;" /></form>
  </div>
</div>

<br /><br/>
<!-- h2>grains</h2 -->
<form method="post" action="./grain/" id="grain_form">
  <input type="hidden" name="delete_id" value="-1"/>
<table width="70%">
  <tr>
    <th>grain</th>
    <th>amount</th>
    <th py:if="std.auth_user_is_user(request, recipe.author)">&mdash;</th>
  </tr>
  <tr py:for="grain in grains">
    <td>${grain.grain.name}</td>
    <td>${grain.amount_value} ${grain.amount_units}</td>
    <td py:if="std.auth_user_is_user(request, recipe.author)"><a href="#" onClick="set_delete_id_and_submit('grain_form', ${grain.id}); return false;">(del)</a></td>
  </tr>
  <div py:if="std.auth_user_is_user(request, recipe.author)" py:strip="True">
      <tr class="add">
          <td colspan="3"><a href="#" class="add-button" onClick="$('#grain_form .add').toggle(); $('#grain_form .add :input:first').focus(); return false;">(add)</a></td>
      </tr>
      <tr class="add" style="display:none">
          <td>${std.Markup(grain_form['grain'])}</td>
          <td>${std.Markup(grain_form['amount_value'])} ${std.Markup(grain_form['amount_units'])}</td>
          <td><input type="submit" name="submit" value="add"/>
          <input type="reset" value="cancel" onClick="$('#grain_form .add').toggle(); $('#grain_form .add-button').focus(); return true;" /></td>
      </tr>
  </div>
</table>
</form>

<br /><br/>
<!-- h2>hops</h2 -->

<form method="post" action="./hop/" id="hop_form">
  <input type="hidden" name="delete_id" value="-1"/>
<table width="70%">
  <tr>
    <th>hop</th>
    <th>amount</th>
    <th>boil time</th>
    <th py:if="std.auth_user_is_user(request, recipe.author)">&mdash;</th>
  </tr>
  <tr py:for="hop in hops">
    <td>${hop.hop.name}</td>
    <td>${hop.amount_value} ${hop.amount_units}</td>
    <td>${hop.boil_time} minutes</td>
    <td py:if="std.auth_user_is_user(request, recipe.author)"><a href="#" onClick="set_delete_id_and_submit('hop_form', ${hop.id}); return false;">(del)</a></td>
  </tr>
  <div py:if="std.auth_user_is_user(request, recipe.author)" py:strip="True">
      <tr class="add">
          <td colspan="4"><a href="#" onClick="$('#hop_form .add').toggle(); return false;">(add)</a></td>
      </tr>
      <tr class="add" style="display:none">
          <td>${std.Markup(hop_form['hop'])}</td>
          <td>${std.Markup(hop_form['amount_value'])} ${std.Markup(hop_form['amount_units'])}</td>
          <td>${std.Markup(hop_form['boil_time'])} minutes</td>
          <td><input type="submit" value="add"/></td>
      </tr>
  </div>
</table>
</form>

<!-- h2>adjuncts</h2 -->
<br/><br/>

<form method="post" action="./adjunct/" id="adj_form">
  <input type="hidden" name="delete_id" value="-1"/>
<table width="70%">
  <tr>
    <th>adjunct</th>
    <th>amount</th>
    <th>boil time</th>
    <th>notes</th>
    <th py:if="std.auth_user_is_user(request, recipe.author)">&mdash;</th>
  </tr>
  <tr py:for="adjunct in adjuncts" class="deletable">
    <td>${adjunct.adjunct.name}</td>
    <td>${adjunct.amount_value} ${adjunct.amount_units}</td>
    <td>${adjunct.boil_time} minutes</td>
    <td>${adjunct.notes}</td>
    <td py:if="std.auth_user_is_user(request, recipe.author)"><a href="#" onClick="set_delete_id_and_submit('adj_form', ${adjunct.id}); return false;">(del)</a></td>
  </tr>
  <div py:if="std.auth_user_is_user(request, recipe.author)" py:strip="True">
      <tr class="add">
          <td colspan="5"><a href="#" onClick="$('#adj_form .add').toggle(); return false;">(add)</a></td>
      </tr>
      <tr class="add" style="display:none">
          <td>${std.Markup(adj_form['adjunct'])}</td>
          <td>${std.Markup(adj_form['amount_value'])} ${std.Markup(adj_form['amount_units'])}</td>
          <td>${std.Markup(adj_form['boil_time'])} minutes</td>
          <td>${std.Markup(adj_form['notes'])}</td>
          <td><input type="submit" value="add" /></td>
      </tr>
  </div>
</table>
</form>

<br /><br/>
<!-- h2>yeast</h2 -->
<form method="post" action="./yeast/" id="yeast_form">
  <input type="hidden" name="delete_id" value="-1"/>
<table width="70%">
  <tr>
    <th>yeast</th>
    <th>is ideal</th>
    <th py:if="std.auth_user_is_user(request, recipe.author)">&mdash;</th>
  </tr>
  <tr py:for="yeast in yeasts" class="deletable">
    <td>${yeast.yeast}</td>
    <td>${yeast.ideal}</td>
    <td py:if="std.auth_user_is_user(request, recipe.author)"><a href="#" onClick="set_delete_id_and_submit('yeast_form', ${yeast.id}); return false;">(del)</a></td>
  </tr>
  <div py:if="std.auth_user_is_user(request, recipe.author)" py:strip="True">
       <tr class="add">
           <td colspan="5"><a href="#" onClick="$('#yeast_form .add').toggle(); return false;">(add)</a></td>
       </tr>
       <tr class="add" style="display:none">
           <td>${std.Markup(yeast_form['yeast'])}</td>
           <td>${std.Markup(yeast_form['ideal'])}</td>
           <td><input type="submit" value="add" /></td>
       </tr>
  </div>
</table>
</form>

</body>
</html>
