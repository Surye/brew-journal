<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include href="../_incl/taglib.html"/>
<head>
  <title>${user.username} | Brew Journal</title>
  <xi:include href="../_incl/head.html"/>
</head>
<body>
  <xi:include href="../_incl/body-top-bar.html"/>

<h1>${user.username} current brews</h1>
<py:if test="std.auth_user_is_user(request, user)">
  <a href="/user/${user.username}/brew/new">${action('create new brew')}</a><br/><br />
</py:if>
<table width="80%">
  <thead>
    <tr>
      <th>brew</th>
      <th>brew date</th>
      <th>last update</th>
      <th>state</th>
      <th py:if="std.auth_user_is_user(request, user)" width="40%">action</th>
    </tr>
  </thead>
  <tbody>
    <tr py:if="not brews">
      <td colspan="3"><em>no active brews</em></td>
    </tr>
    <tr py:for="brew in brews">
      <td><a href="/user/${brew.brewer.username}/brew/${brew.id}">${brew.recipe.name}</a></td>
      <td>${std.fmt.date.ymd(brew.brew_date)}</td>
      <td>${std.fmt.date.ymdhm(brew.last_update_date)}</td>
      <td>${brew.get_last_state_display()}</td>
      <span py:def="step(brew, next)" py:strip="True"><a href="/user/${brew.brewer.username}/brew/${brew.id}/?type=${next.id}">${action(next.label)}</a> </span>
      <td py:if="std.auth_user_is_user(request, user)">
          <py:for each="next in brew.next_step_types()[0:2]">
              ${step(brew, next)}
          </py:for>
          <py:if test="len(brew.next_step_types()) > 2">
              <span id="more_steps_brew_${brew.id}">
                  <span>
                      <a href="#" onClick="$('#more_steps_brew_${brew.id}').children().toggle(); return false;">(more)</a>
                  </span>
                  <span style="display: none">
                      <py:for each="next in brew.next_step_types()[2:]">
                          ${step(brew, next)}
                      </py:for>
                      <a href="#" onClick="$('#more_steps_brew_${brew.id}').children().toggle(); return false;">(less)</a>
                  </span>
              </span>
          </py:if>
      </td>
    </tr>
  </tbody>
</table>
<br />

<h1>starred recipes</h1>
<table width="80%">
  <thead>
    <tr>
      <th>name</th>
      <th>author</th>
      <th>style</th>
      <th>when</th>
      <th>action</th>
    </tr>
  </thead>
  <tbody>
    <tr py:if="not starred_recipes">
      <td colspan="5"><em>no starred recipes, yet.</em></td>
    </tr>
    <tr py:for="starred in starred_recipes">
      <td>${recipe_a(starred.recipe)}</td>
      <td><a href="/user/${starred.recipe.author.username}/">${starred.recipe.author}</a></td>
      <td>${starred.recipe.style.name}</td>
      <td>${std.fmt.date.ymdhm(starred.when)}</td>
      <td><a href="/recipe/new/?clone_from_recipe_id=${starred.recipe.id}">${action('clone')}</a>
          &nbsp;<a href="/user/${request.user.username}/brew/new/?recipe_id=${starred.recipe.id}">${action('brew')}</a>
      </td>
    </tr>
  </tbody>
</table>

<h1>authored recipes</h1>
<py:if test="std.auth_user_is_user(request, user)">
  <a href="/recipe/new/">${action('create new recipe')}</a><br /><br />
</py:if>
<table width="80%">
  <thead>
    <tr>
      <th>name</th>
      <th>style (type)</th>
      <th>date</th>
      <th>actions</th>
    </tr>
  </thead>
  <tbody>
    <tr py:if="not authored_recipes">
      <td colspan="4"><em>no recipes authored</em>
      <py:if test="request.user.is_authenticated() and request.user == user">
        <a href="/recipe/new/">(create recipe)</a>
      </py:if>
      </td>
    </tr>
    <tr py:for="recipe in authored_recipes">
      <td>${recipe_a(recipe)}</td>
      <td>${recipe.style.name} (${recipe.get_type_display()})</td>
      <td>${std.fmt.date.ymd(recipe.insert_date)}</td>
      <td><a href="/recipe/new/?clone_from_recipe_id=${recipe.id}">${action('clone')}</a>
       <a href="/user/${request.user.username}/star/?recipe_id=${recipe.id}">${action('star')}</a>
       <a href="/user/${request.user.username}/brew/new/?recipe_id=${recipe.id}">${action('brew')}</a>
      </td>
    </tr>
  </tbody>
</table>
<br />

<h1>historical brews</h1>
<table width="80%">
  <thead>
    <tr>
      <th>brew</th>
      <th>brew date</th>
      <th>last update</th>
    </tr>
  </thead>
  <tbody>
    <tr py:if="not done_brews">
      <td colspan="3"><em>no historical brews</em></td>
    </tr>
    <tr py:for="brew in done_brews">
      <td><a href="/user/${brew.brewer.username}/brew/${brew.id}">${brew.recipe.name}</a></td>
      <td>${std.fmt.date.ymd(brew.brew_date)}</td>
      <td>${std.fmt.date.ymdhm(brew.last_update_date)}</td>
    </tr>
  </tbody>
</table>
</body>
</html>
