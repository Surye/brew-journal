<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include href="../../_incl/taglib.html"/>

<head>
  <title>brew of "${brew.recipe.name}" | Brew Journal</title>
  <xi:include href="../../_incl/head.html"/>
</head>
<body>
  <xi:include href="../../_incl/body-top-bar.html"/>
  <h1>brew of "${brew.recipe.name}"</h1>
  <div id="details">
      <div>
          <span py:if="brew.brew_date">brewed on ${std.fmt.date.ymd(brew.brew_date)} by ${brew.brewer.username}<br /></span>
          <span py:if="brew.recipe">from recipe ${recipe_a(brew.recipe)}.</span>
          <h2>notes</h2>
          <div class="notes" py:if="brew.notes and len(brew.notes) > 0"><pre class="notes">${brew.notes}</pre></div>
          <div py:if="not brew.notes or len(brew.notes) == 0"><em>(none)</em></div>
          <a py:if="std.auth_user_is_user(request, user)" href="#" onClick="$('#details').children().slideToggle(); return false;">edit brew details &uarr;</a>
      </div>
      <div py:if="std.auth_user_is_user(request, user)" style="display:none">
          <h2>edit</h2>
          <form method="post" id="details-form" action="/user/${brew.brewer.username}/brew/${brew.id}/edit/">
              <table class="form" py:content="std.Markup(brew_form.as_table())"/>
              <input type="submit" value="update"/>
              <button onClick="$('#details').children().slideToggle(); $('#details-form').get()[0].reset(); return false;">cancel</button>
          </form>
      </div>
  </div>

  <h2>log</h2>

  <table width="95%">
    <thead>
      <tr>
        <th>date</th>
        <th>step</th>
        <th>volume</th>
        <th>temp</th>
        <th>gravity (corrected)</th>
        <th>notes</th>
      </tr>
    </thead>
    <tbody>
      <tr py:if="not steps">
        <td colspan="1000"><em>no steps recorded, yet.</em></td>
      </tr>
      <tr py:for="step in steps">
        <td><a href="/user/${user.username}/brew/${brew.id}/step/${step.id}">${std.fmt.date.ymdhm(step.date)}</a></td>
        <td>${step.type}</td>
        <td>${step.volume}</td>
        <td>${step.temp}</td>
        <td>${step.gravity}</td>
        <td>${step.notes}</td>
      </tr>
    </tbody>
  </table>
  <br />
  <div py:if="std.auth_user_is_user(request, user)" id="add-step">
    <a href="#" onClick="$('#add-step').children().slideToggle(); return false;">add new log step &darr;</a>
    <div><!-- empty --></div>
    <div style="display:none">
        <form method="post" id="add-step-form">
            <table class="form" py:content="std.Markup(step_form.as_table())"/>
            <input type="submit" value="${submit_label}"/>
            <button onClick="$('#add-step').children().slideToggle(); $('#add-step-form').get()[0].reset(); return false;">Cancel</button>
        </form>
    </div>
  </div>

<h1>derivations</h1>
<table>
  <tr>
    <th>efficiency</th>
    <td py:if="deriv.can_not_derive_efficiency()">
      <py:for each="reason in deriv.can_not_derive_efficiency()">
        ${reason}<br/>
      </py:for>
    </td>
    <td py:if="not deriv.can_not_derive_efficiency()">${'%0.2f' % deriv.efficiency()}%</td>
  </tr>
</table>
</body>
</html>
