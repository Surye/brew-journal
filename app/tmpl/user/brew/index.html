<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:py="http://genshi.edgewall.org/"
      xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include href="../../_incl/taglib.html"/>

<head>
  <title>brew of "${brew.recipe.name}" | brew-journal</title>
  <xi:include href="../../_incl/head.html"/>
  <script type="application/javascript">
    $(document).ready(function(){
      $('#first-focused').focus();
    });
  </script>
</head>
<body>
    <div id="doc3">
        <xi:include href="../../_incl/body-top-bar.html"/>

        <div id="bd">
            <div id="yui-main">
                <div class="yui-b">

  <h1 py:if="brew.recipe">brew of "${brew.recipe.name}"</h1>
  <h1 py:if="not brew.recipe">un-named brew</h1>
  <div id="details">
      <div>
          <span py:if="brew.brew_date">brewed on ${std.fmt.date.ymd(brew.brew_date)} </span>
          by <a href="/user/${brew.brewer.username}/">${brew.brewer.username}</a>
          <span py:if="brew.recipe">from recipe ${recipe_a(brew.recipe)}</span>
          <h2>notes</h2>
          <div class="notes" py:if="brew.notes and len(brew.notes) > 0"><pre class="notes">${brew.notes}</pre></div>
          <div py:if="not brew.notes or len(brew.notes) == 0"><em>(none)</em></div>
          <a py:if="std.auth_user_is_user(request, user)" href="#" id="first-focused" onClick="$('#details').children().slideToggle(); return false;">edit brew details &uarr;</a>
      </div>
      <div py:if="std.auth_user_is_user(request, user)" style="display:none">
          <h2>edit</h2>
          <form method="post" id="details-form" action="/user/${brew.brewer.username}/brew/${brew.id}/edit/">
              <table class="form" py:content="std.Markup(brew_form.as_table())"/>
              <input type="submit" value="update"/>
              <button onClick="$('#details').children().slideToggle(); $('#details-form').get()[0].reset(); return false;">cancel</button>
          </form>
      </div>
  </div>

  <h2>log</h2>

  <?python
    now_steps = [step for step in steps if not step.in_future()]
    future_steps = [step for step in steps if step.in_future()]
  ?>
  <py:def function="step_row(std,user,brew,step)">
      <td><a href="/user/${user.username}/brew/${brew.id}/step/${step.id}">${std.fmt.date.ymdhm(step.date)}</a></td>
      <td>${step.get_type_display()}</td>
      <td><py:if test="step.volume">${step.volume} ${step.volume_units}</py:if></td>
      <td><py:if test="step.temp">${step.temp} ${step.temp_units}</py:if></td>
      <td>${step.gravity}</td>
      <td>${step.notes}</td>
  </py:def>
  <table width="95%">
    <thead>
      <tr>
        <th>date</th>
        <th>step</th>
        <th>volume</th>
        <th>temp</th>
        <th>gravity (corrected)</th>
        <th>notes</th>
      </tr>
    </thead>
    <tbody>
      <tr py:if="not steps">
        <td colspan="1000"><em>no steps recorded, yet.</em></td>
      </tr>
      <tr py:for="step in now_steps">${step_row(std,user,brew,step)}</tr>
    </tbody>
    <tbody py:if="future_steps" class="future">
        <tr py:for="step in future_steps">${step_row(std,user,brew,step)}</tr>
    </tbody>
  </table>
  <br />
  <div py:if="std.auth_user_is_user(request, user)" id="add-step">
    <div py:attrs="{'style': 'display:' + ['inherit', 'none'][step_edit]}">
      <a href="#" onClick="$('#add-step').children().slideToggle(); $('#add-step-form :input:first').focus(); return false;">update step &darr;</a>
    </div>
    <div py:attrs="{'style': 'display:' + ['inherit', 'none'][not step_edit]}">
        <form method="post" id="add-step-form">
            <table class="form" py:content="std.Markup(step_form.as_table())"/>
            <input type="submit" value="update step"/>
            <button onClick="$('#add-step').children().slideToggle(); $('#add-step-form').get()[0].reset(); $('#first-focused').focus(); return false;">Cancel</button>
        </form>
    </div>
  </div>

<h1>derivations</h1>
<table>
  <tr>
    <th>efficiency</th>
    <td py:if="deriv.can_not_derive_efficiency()">
      <div id="why_not_efficiency">
          <div class="muted">
              can't yet compute. <a href="#" onClick="$('#why_not_efficiency').children().slideToggle(); return false;">(why not?)</a>
          </div>
          <div style="display:none">
              <py:for each="reason in deriv.can_not_derive_efficiency()">
                  ${reason}<br/>
              </py:for>
              <a class="muted" href="#" onClick="$('#why_not_efficiency').children().slideToggle(); return false;">(hide)</a><br />
          </div>
      </div>
    </td>
    <td py:if="not deriv.can_not_derive_efficiency()">${'%0.2f' % deriv.efficiency()}%</td>
  </tr>
  <tr>
    <th>alcohol by volume</th>
    <td py:if="deriv.can_not_derive_abv()">
      <div id="why_not_abv">
          <div class="muted">
              can't yet compute. <a href="#" onClick="$('#why_not_abv').children().slideToggle(); return false;">(why not?)</a>
          </div>
          <div style="display:none">
              <py:for each="reason in deriv.can_not_derive_abv()">
                  ${reason}<br />
              </py:for>
              <a class="muted" href="#" onClick="$('#why_not_abv').children().slideToggle(); return false;">(hide)</a><br />
          </div>
      </div>
    </td>
    <td py:if="not deriv.can_not_derive_abv()">
      ${'%0.2f' % (deriv.alcohol_by_volume())}%
    </td>
  </tr>
</table>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
